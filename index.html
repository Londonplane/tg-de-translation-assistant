<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中德翻译助手</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- 导航栏 -->
        <nav class="navbar">
            <div class="nav-brand">
                <h1>🇩🇪 中德翻译助手</h1>
            </div>
            <div class="nav-menu">
                <button class="nav-btn active" data-module="cn-to-de">
                    <span class="nav-icon">🇨🇳➡️🇩🇪</span>
                    <span class="nav-text">中译德</span>
                </button>
                <button class="nav-btn" data-module="de-to-cn">
                    <span class="nav-icon">🇩🇪➡️🇨🇳</span>
                    <span class="nav-text">德译中</span>
                </button>
                <button class="nav-btn" data-module="ocr-recognition">
                    <span class="nav-icon">📷</span>
                    <span class="nav-text">图片识别</span>
                </button>
                <button class="nav-btn" data-module="du-sie">
                    <span class="nav-icon">👤↔️</span>
                    <span class="nav-text">你/您切换</span>
                </button>
                <button class="nav-btn" data-module="grammar-check">
                    <span class="nav-icon">✏️</span>
                    <span class="nav-text">德语检查</span>
                </button>
                <button class="nav-btn" data-module="assistant">
                    <span class="nav-icon">🤖</span>
                    <span class="nav-text">德语助手</span>
                </button>
            </div>
        </nav>



        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 模块1: 中译德 -->
            <div id="cn-to-de" class="module active">
                <div class="module-header">
                    <div class="header-left-buttons">
                        <button class="tutorial-btn" id="tutorial-btn" title="查看使用教程">
                            <span class="btn-icon">📚</span>
                            使用教程
                        </button>
                        <button class="shortcut-btn" id="shortcut-btn" title="设置快捷键">
                            <span class="btn-icon">⌨️</span>
                            快捷键设置
                        </button>
                    </div>
                    <h2>中文翻译成德语</h2>
                    <p class="module-desc">选择角色和场景，获得精准的德语翻译</p>
                    <button class="add-task-btn" id="add-task-btn" title="添加新的翻译任务">
                        <span class="btn-icon">➕</span>
                        添加任务
                    </button>
                </div>
                
                <!-- 多任务容器 -->
                <div class="multi-task-container">
                    <!-- 任务1 -->
                    <div class="task-area" id="task-area-1" data-task-id="1">
                        <div class="task-header">
                            <input type="text" class="task-title-input" id="task-title-1" value="任务1" placeholder="点击编辑任务名称...">
                        </div>
                        
                        <div class="content-grid">
                            <div class="input-section">
                                <div class="input-label-row">
                                    <label for="cn-input-1">中文文本</label>
                                    <div class="timer-display" id="timer-display-1" style="display: none;">
                                        <span class="timer-icon">⏱️</span>
                                        <span class="timer-text">结果获得时间：</span>
                                        <span class="timer-value" id="timer-value-1">00:00</span>
                                    </div>
                                </div>
                                <textarea id="cn-input-1" placeholder="请输入要翻译的中文内容..."></textarea>
                            </div>

                            <div class="settings-section">
                                <div class="setting-group">
                                    <label>选择翻译角色</label>
                                    <div class="radio-group">
                                        <label class="radio-option" title="权威但友善的群聊风格，适合男性教授在投资群中分享见解">
                                            <input type="radio" name="role-1" value="male-professor" checked>
                                            <span>👨‍🎓 男教授</span>
                                        </label>
                                        <label class="radio-option" title="权威但温和的群聊风格，适合女性教授在投资群中提供指导">
                                            <input type="radio" name="role-1" value="female-professor">
                                            <span>👩‍🎓 女教授</span>
                                        </label>
                                        <label class="radio-option" title="热情主动的群聊风格，适合男性助理为群友提供帮助">
                                            <input type="radio" name="role-1" value="male-assistant">
                                            <span>👨‍💼 男助理</span>
                                        </label>
                                        <label class="radio-option" title="贴心细致的群聊风格，适合女性助理温馨提醒和帮助">
                                            <input type="radio" name="role-1" value="female-assistant">
                                            <span>👩‍💼 女助理</span>
                                        </label>
                                        <label class="radio-option" title="活跃幽默的群聊风格，能带动气氛引发互动">
                                            <input type="radio" name="role-1" value="male-troll">
                                            <span>🙋‍♂️ 男水军</span>
                                        </label>
                                        <label class="radio-option" title="活跃生动的群聊风格，善于活跃氛围制造话题">
                                            <input type="radio" name="role-1" value="female-troll">
                                            <span>🙋‍♀️ 女水军</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="output-section">
                                <div class="output-group">
                                    <div class="output-label-row">
                                        <label>德语译文 <span style="color: #6b7280; font-size: 0.8rem;">(可编辑)</span></label>
                                        <div id="pronoun-info-1" class="pronoun-info" style="display: none;"></div>
                                    </div>
                                    <textarea id="de-output-1" placeholder="德语翻译结果将显示在这里..."></textarea>
                                </div>

                                <div class="output-group">
                                    <label>回译检查</label>
                                    <textarea id="back-translation-1" readonly placeholder="德语回译成中文的结果..."></textarea>
                                </div>
                            </div>

                            <div class="action-section">
                                <div class="btn-group">
                                    <button class="btn btn-secondary" id="remove-comments-btn-1">
                                        <span class="btn-icon">🧹</span>
                                        去除备注
                                    </button>
                                    <button class="btn btn-primary" id="translate-btn-1">
                                        <span class="btn-icon">🔄</span>
                                        翻译
                                    </button>
                                    <button class="btn btn-secondary" id="clear-btn-1">
                                        <span class="btn-icon">🗑️</span>
                                        清空
                                    </button>
                                    <button class="btn btn-secondary" id="retranslate-btn-1">
                                        <span class="btn-icon">🔄</span>
                                        重新翻译
                                    </button>
                                    <button class="btn btn-secondary" id="du-sie-switch-btn-1" disabled>
                                        <span class="btn-icon">🔄</span>
                                        你您切换
                                    </button>
                                    <button class="btn btn-secondary" id="remove-dash-btn-1" disabled>
                                        <span class="btn-icon">✂️</span>
                                        去短横线
                                    </button>
                                    <button class="btn btn-secondary" id="remove-emoji-btn-1" disabled>
                                        <span class="btn-icon">😶</span>
                                        去除表情
                                    </button>
                                </div>
                                
                                <div class="copy-group">
                                    <label>一键复制</label>
                                    <div class="btn-group">
                                        <button class="btn btn-outline" id="copy-original-1">原文</button>
                                        <button class="btn btn-outline" id="copy-translation-1">译文</button>
                                        <button class="btn btn-outline" id="copy-both-1">原文+译文</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 任务2 -->
                    <div class="task-area" id="task-area-2" data-task-id="2" style="display: none;">
                        <div class="task-header">
                            <input type="text" class="task-title-input" id="task-title-2" value="任务2" placeholder="点击编辑任务名称...">
                            <button class="remove-task-btn" id="remove-task-btn-2" title="删除此任务">×</button>
                        </div>
                        
                        <div class="content-grid">
                            <div class="input-section">
                                <div class="input-label-row">
                                    <label for="cn-input-2">中文文本</label>
                                    <div class="timer-display" id="timer-display-2" style="display: none;">
                                        <span class="timer-icon">⏱️</span>
                                        <span class="timer-text">结果获得时间：</span>
                                        <span class="timer-value" id="timer-value-2">00:00</span>
                                    </div>
                                </div>
                                <textarea id="cn-input-2" placeholder="请输入要翻译的中文内容..."></textarea>
                            </div>

                            <div class="settings-section">
                                <div class="setting-group">
                                    <label>选择翻译角色</label>
                                    <div class="radio-group">
                                        <label class="radio-option" title="权威但友善的群聊风格，适合男性教授在投资群中分享见解">
                                            <input type="radio" name="role-2" value="male-professor" checked>
                                            <span>👨‍🎓 男教授</span>
                                        </label>
                                        <label class="radio-option" title="权威但温和的群聊风格，适合女性教授在投资群中提供指导">
                                            <input type="radio" name="role-2" value="female-professor">
                                            <span>👩‍🎓 女教授</span>
                                        </label>
                                        <label class="radio-option" title="热情主动的群聊风格，适合男性助理为群友提供帮助">
                                            <input type="radio" name="role-2" value="male-assistant">
                                            <span>👨‍💼 男助理</span>
                                        </label>
                                        <label class="radio-option" title="贴心细致的群聊风格，适合女性助理温馨提醒和帮助">
                                            <input type="radio" name="role-2" value="female-assistant">
                                            <span>👩‍💼 女助理</span>
                                        </label>
                                        <label class="radio-option" title="活跃幽默的群聊风格，能带动气氛引发互动">
                                            <input type="radio" name="role-2" value="male-troll">
                                            <span>🙋‍♂️ 男水军</span>
                                        </label>
                                        <label class="radio-option" title="活跃生动的群聊风格，善于活跃氛围制造话题">
                                            <input type="radio" name="role-2" value="female-troll">
                                            <span>🙋‍♀️ 女水军</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="output-section">
                                <div class="output-group">
                                    <div class="output-label-row">
                                        <label>德语译文 <span style="color: #6b7280; font-size: 0.8rem;">(可编辑)</span></label>
                                        <div id="pronoun-info-2" class="pronoun-info" style="display: none;"></div>
                                    </div>
                                    <textarea id="de-output-2" placeholder="德语翻译结果将显示在这里..."></textarea>
                                </div>

                                <div class="output-group">
                                    <label>回译检查</label>
                                    <textarea id="back-translation-2" readonly placeholder="德语回译成中文的结果..."></textarea>
                                </div>
                            </div>

                            <div class="action-section">
                                <div class="btn-group">
                                    <button class="btn btn-secondary" id="remove-comments-btn-2">
                                        <span class="btn-icon">🧹</span>
                                        去除备注
                                    </button>
                                    <button class="btn btn-primary" id="translate-btn-2">
                                        <span class="btn-icon">🔄</span>
                                        翻译
                                    </button>
                                    <button class="btn btn-secondary" id="clear-btn-2">
                                        <span class="btn-icon">🗑️</span>
                                        清空
                                    </button>
                                    <button class="btn btn-secondary" id="retranslate-btn-2">
                                        <span class="btn-icon">🔄</span>
                                        重新翻译
                                    </button>
                                    <button class="btn btn-secondary" id="du-sie-switch-btn-2" disabled>
                                        <span class="btn-icon">🔄</span>
                                        你您切换
                                    </button>
                                    <button class="btn btn-secondary" id="remove-dash-btn-2" disabled>
                                        <span class="btn-icon">✂️</span>
                                        去短横线
                                    </button>
                                    <button class="btn btn-secondary" id="remove-emoji-btn-2" disabled>
                                        <span class="btn-icon">😶</span>
                                        去除表情
                                    </button>
                                </div>
                                
                                <div class="copy-group">
                                    <label>一键复制</label>
                                    <div class="btn-group">
                                        <button class="btn btn-outline" id="copy-original-2">原文</button>
                                        <button class="btn btn-outline" id="copy-translation-2">译文</button>
                                        <button class="btn btn-outline" id="copy-both-2">原文+译文</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 任务3 -->
                    <div class="task-area" id="task-area-3" data-task-id="3" style="display: none;">
                        <div class="task-header">
                            <input type="text" class="task-title-input" id="task-title-3" value="任务3" placeholder="点击编辑任务名称...">
                            <button class="remove-task-btn" id="remove-task-btn-3" title="删除此任务">×</button>
                        </div>
                        
                        <div class="content-grid">
                            <div class="input-section">
                                <div class="input-label-row">
                                    <label for="cn-input-3">中文文本</label>
                                    <div class="timer-display" id="timer-display-3" style="display: none;">
                                        <span class="timer-icon">⏱️</span>
                                        <span class="timer-text">结果获得时间：</span>
                                        <span class="timer-value" id="timer-value-3">00:00</span>
                                    </div>
                                </div>
                                <textarea id="cn-input-3" placeholder="请输入要翻译的中文内容..."></textarea>
                            </div>

                            <div class="settings-section">
                                <div class="setting-group">
                                    <label>选择翻译角色</label>
                                    <div class="radio-group">
                                        <label class="radio-option" title="权威但友善的群聊风格，适合男性教授在投资群中分享见解">
                                            <input type="radio" name="role-3" value="male-professor" checked>
                                            <span>👨‍🎓 男教授</span>
                                        </label>
                                        <label class="radio-option" title="权威但温和的群聊风格，适合女性教授在投资群中提供指导">
                                            <input type="radio" name="role-3" value="female-professor">
                                            <span>👩‍🎓 女教授</span>
                                        </label>
                                        <label class="radio-option" title="热情主动的群聊风格，适合男性助理为群友提供帮助">
                                            <input type="radio" name="role-3" value="male-assistant">
                                            <span>👨‍💼 男助理</span>
                                        </label>
                                        <label class="radio-option" title="贴心细致的群聊风格，适合女性助理温馨提醒和帮助">
                                            <input type="radio" name="role-3" value="female-assistant">
                                            <span>👩‍💼 女助理</span>
                                        </label>
                                        <label class="radio-option" title="活跃幽默的群聊风格，能带动气氛引发互动">
                                            <input type="radio" name="role-3" value="male-troll">
                                            <span>🙋‍♂️ 男水军</span>
                                        </label>
                                        <label class="radio-option" title="活跃生动的群聊风格，善于活跃氛围制造话题">
                                            <input type="radio" name="role-3" value="female-troll">
                                            <span>🙋‍♀️ 女水军</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div class="output-section">
                                <div class="output-group">
                                    <div class="output-label-row">
                                        <label>德语译文 <span style="color: #6b7280; font-size: 0.8rem;">(可编辑)</span></label>
                                        <div id="pronoun-info-3" class="pronoun-info" style="display: none;"></div>
                                    </div>
                                    <textarea id="de-output-3" placeholder="德语翻译结果将显示在这里..."></textarea>
                                </div>

                                <div class="output-group">
                                    <label>回译检查</label>
                                    <textarea id="back-translation-3" readonly placeholder="德语回译成中文的结果..."></textarea>
                                </div>
                            </div>

                            <div class="action-section">
                                <div class="btn-group">
                                    <button class="btn btn-secondary" id="remove-comments-btn-3">
                                        <span class="btn-icon">🧹</span>
                                        去除备注
                                    </button>
                                    <button class="btn btn-primary" id="translate-btn-3">
                                        <span class="btn-icon">🔄</span>
                                        翻译
                                    </button>
                                    <button class="btn btn-secondary" id="clear-btn-3">
                                        <span class="btn-icon">🗑️</span>
                                        清空
                                    </button>
                                    <button class="btn btn-secondary" id="retranslate-btn-3">
                                        <span class="btn-icon">🔄</span>
                                        重新翻译
                                    </button>
                                    <button class="btn btn-secondary" id="du-sie-switch-btn-3" disabled>
                                        <span class="btn-icon">🔄</span>
                                        你您切换
                                    </button>
                                    <button class="btn btn-secondary" id="remove-dash-btn-3" disabled>
                                        <span class="btn-icon">✂️</span>
                                        去短横线
                                    </button>
                                    <button class="btn btn-secondary" id="remove-emoji-btn-3" disabled>
                                        <span class="btn-icon">😶</span>
                                        去除表情
                                    </button>
                                </div>
                                
                                <div class="copy-group">
                                    <label>一键复制</label>
                                    <div class="btn-group">
                                        <button class="btn btn-outline" id="copy-original-3">原文</button>
                                        <button class="btn btn-outline" id="copy-translation-3">译文</button>
                                        <button class="btn btn-outline" id="copy-both-3">原文+译文</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 模块2: 德译中 -->
            <div id="de-to-cn" class="module">
                <div class="module-header">
                    <h2>德语翻译成中文</h2>
                    <p class="module-desc">将德语文本翻译成中文</p>
                </div>
                
                <div class="content-simple">
                    <div class="input-section">
                        <label for="de-input">德语文本</label>
                        <textarea id="de-input" placeholder="请输入要翻译的德语内容..."></textarea>
                        <div class="language-detection" id="language-detection" style="display: none;">
                            <span class="detection-label">🔍 检测语言:</span>
                            <span class="detected-language" id="detected-language"></span>
                        </div>
                    </div>

                    <div class="output-section">
                        <label>中文译文</label>
                        <textarea id="cn-output" readonly placeholder="中文翻译结果将显示在这里..."></textarea>
                    </div>

                    <div class="action-section">
                        <div class="btn-group">
                            <button class="btn btn-primary" id="de-to-cn-translate">
                                <span class="btn-icon">🔄</span>
                                翻译
                            </button>
                            <button class="btn btn-secondary" id="de-to-cn-retranslate">
                                <span class="btn-icon">🔄</span>
                                重新翻译
                            </button>
                            <button class="btn btn-outline" id="de-to-cn-copy">
                                <span class="btn-icon">📋</span>
                                复制译文
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 模块3: OCR识别 -->
            <div id="ocr-recognition" class="module">
                <div class="module-header">
                    <h2>OCR图片文字识别</h2>
                    <p class="module-desc">上传图片或粘贴图片，自动识别其中的德语和中文内容</p>
                </div>
                
                <div class="content-simple">
                    <div class="input-section">
                        <label>图片输入</label>
                        <div class="image-upload-area" id="image-upload-area">
                            <div class="upload-placeholder">
                                <div class="upload-icon">📷</div>
                                <div class="upload-text">
                                    <p><strong>点击上传图片</strong> 或 <strong>拖拽图片到此处</strong></p>
                                    <p>也可以使用 <kbd>Ctrl+V</kbd> 粘贴剪贴板中的图片</p>
                                    <small>支持 JPG、PNG、GIF、WebP 格式</small>
                                </div>
                            </div>
                            <input type="file" id="image-file-input" accept="image/*" style="display: none;">
                        </div>
                        <div class="image-preview" id="image-preview" style="display: none;">
                            <img id="preview-image" alt="预览图片">
                            <button class="remove-image-btn" id="remove-image-btn" title="移除图片">×</button>
                        </div>
                    </div>

                    <div class="output-section">
                        <label>识别结果 <span style="color: #6b7280; font-size: 0.8rem;">(可编辑)</span></label>
                        <textarea id="ocr-output" placeholder="图片中的文字内容将显示在这里..."></textarea>
                    </div>

                    <div class="action-section">
                        <div class="btn-group">
                            <button class="btn btn-primary" id="ocr-recognize" disabled>
                                <span class="btn-icon">🔍</span>
                                识别文字
                            </button>
                            <button class="btn btn-secondary" id="ocr-retry" disabled>
                                <span class="btn-icon">🔄</span>
                                重新识别
                            </button>
                            <button class="btn btn-outline" id="ocr-copy">
                                <span class="btn-icon">📋</span>
                                复制文字
                            </button>
                            <button class="btn btn-secondary" id="ocr-clear">
                                <span class="btn-icon">🗑️</span>
                                清空
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 模块4: Du/Sie切换 -->
            <div id="du-sie" class="module">
                <div class="module-header">
                    <h2>你/您切换 (Du/Sie)</h2>
                    <p class="module-desc">Du(你): du/dir/dich/deine | Sie(您): Sie/Ihnen/Sie/Ihre</p>
                </div>
                
                <div class="content-simple">
                    <div class="input-section">
                        <label for="du-sie-input">德语文本</label>
                        <textarea id="du-sie-input" placeholder="请输入要转换的德语文本..."></textarea>
                    </div>

                    <div class="output-section">
                        <label>转换结果</label>
                        <textarea id="du-sie-output" readonly placeholder="转换结果将显示在这里..."></textarea>
                    </div>

                    <div class="action-section">
                        <div class="btn-group">
                            <button class="btn btn-primary" id="convert-to-du">
                                <span class="btn-icon">👤</span>
                                转换为 Du (你)
                            </button>
                            <button class="btn btn-primary" id="convert-to-sie">
                                <span class="btn-icon">👥</span>
                                转换为 Sie (您)
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 模块5: 德语检查 -->
            <div id="grammar-check" class="module">
                <div class="module-header">
                    <h2>德语文本检查</h2>
                    <p class="module-desc">AI 语法检查和表达优化</p>
                </div>
                
                <div class="content-simple">
                    <div class="input-section">
                        <label for="grammar-input">德语文本</label>
                        <textarea id="grammar-input" placeholder="请输入要检查的德语文本..."></textarea>
                        
                        <label for="grammar-chinese-input">中文文本（可选）</label>
                        <textarea id="grammar-chinese-input" placeholder="如果需要对比翻译，请输入对应的中文文本..."></textarea>
                    </div>

                    <div class="output-section">
                        <label>检查结果</label>
                        <div id="grammar-result" class="grammar-result"></div>
                    </div>

                    <div class="action-section">
                        <div class="btn-group">
                            <button class="btn btn-primary" id="check-grammar">
                                <span class="btn-icon">✏️</span>
                                检查文本
                            </button>
                            <button class="btn btn-secondary" id="clear-grammar">
                                <span class="btn-icon">🗑️</span>
                                清空
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 模块6: 德语助手 -->
            <div id="assistant" class="module">
                <div class="module-header">
                    <h2>德语小助手</h2>
                    <p class="module-desc">德语语法解释、词汇查询、文化背景知识</p>
                </div>
                
                <div class="content-simple">
                    <div class="input-section">
                        <label for="assistant-input">您的问题</label>
                        <textarea id="assistant-input" placeholder="请输入问题，暂只支持文本.."></textarea>
                    </div>

                    <div class="output-section">
                        <label>AI助手回答</label>
                        <div id="assistant-result" class="assistant-result"></div>
                    </div>

                    <div class="action-section">
                        <div class="btn-group">
                            <button class="btn btn-primary" id="ask-assistant">
                                <span class="btn-icon">🤖</span>
                                询问助手
                            </button>
                            <button class="btn btn-outline" id="copy-assistant-answer">
                                <span class="btn-icon">📋</span>
                                复制回答
                            </button>
                            <button class="btn btn-secondary" id="clear-assistant">
                                <span class="btn-icon">🗑️</span>
                                清空
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 加载提示 -->
        <div id="loading" class="loading hidden">
            <div class="loading-spinner"></div>
            <span>处理中...</span>
        </div>

        <!-- API配置模态框 -->
        <div id="api-config-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🔌 API配置</h3>
                    <button class="close-btn" id="close-api-config">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="config-group">
                        <label for="user-select">选择用户配置</label>
                        <select id="user-select" class="user-select">
                            <option value="">请选择用户配置...</option>
                        </select>
                        <div class="user-actions">
                            <button class="btn btn-outline btn-small" id="add-user-btn">+ 添加配置</button>
                            <button class="btn btn-outline btn-small" id="edit-user-btn" disabled>✏️ 编辑配置</button>
                        </div>
                        <small>💡 提示：添加或更新配置后，再进行测试连接</small>
                    </div>
                    
                    <div class="config-group user-config" id="user-config" style="display: none;">
                        <label for="user-name">用户标识</label>
                        <input type="text" id="user-name" placeholder="输入您的姓名或工号（例如：张三/EMP001）">
                        
                        <label for="api-key">OpenRouter API Key</label>
                        <div class="input-with-copy">
                            <input type="password" id="api-key" placeholder="请输入管理员为您分配的OpenRouter API密钥">
                            <button type="button" class="copy-btn" id="copy-openrouter-key" title="复制API密钥">📋</button>
                            <button type="button" class="show-hide-btn" id="toggle-openrouter-key" title="显示/隐藏密钥">👁️</button>
                        </div>
                        <small>⚠️ 用于AI翻译、回译和语法检查功能</small>
                    </div>
                    
                    <div class="config-group">
                        <label>当前用户状态</label>
                        <div class="current-user-info">
                            <div class="user-info-item">
                                <span class="info-label">当前用户:</span>
                                <span id="current-user-name">未选择</span>
                            </div>
                            <div class="user-info-item">
                                <span class="info-label">API状态:</span>
                                <span id="current-api-status">⚪ 未配置</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-group">
                        <label>API服务状态</label>
                        <div class="model-status">
                            <div class="status-item">
                                <span class="model-name">OpenRouter API (翻译和回译功能)</span>
                                <span class="status-indicator" id="openrouter-status">⚪ 未配置</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-group">
                        <label>用户管理</label>
                        <div class="user-management">
                            <button class="btn btn-outline btn-small" id="delete-user-btn" disabled>删除当前用户</button>
                            <button class="btn btn-outline btn-small" id="export-users-btn">导出用户配置</button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="test-api">测试连接</button>
                    <button class="btn btn-primary" id="save-api-config">保存配置</button>
                </div>
            </div>
        </div>

        <!-- 词汇表模态框 -->
        <div id="vocabulary-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>📚 词汇表管理</h3>
                    <button class="close-btn" id="close-vocabulary-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="config-group">
                        <label for="vocab-user-select">选择用户</label>
                        <select id="vocab-user-select" class="user-select">
                            <option value="">请选择用户...</option>
                        </select>
                        <small>💡 选择用户后查看和编辑其词汇表</small>
                    </div>
                    
                    <div class="config-group" id="vocab-management" style="display: none;">
                        <label>词汇表管理</label>
                        <div class="vocab-actions">
                            <button class="btn btn-primary btn-small" id="add-vocab-btn">+ 添加词汇</button>
                            <button class="btn btn-outline btn-small" id="import-vocab-btn">📁 导入</button>
                            <button class="btn btn-outline btn-small" id="export-vocab-btn">📤 导出</button>
                            <button class="btn btn-secondary btn-small" id="clear-vocab-btn">🗑️清空</button>
                        </div>
                    </div>
                    
                    <div class="config-group" id="vocab-add-form" style="display: none;">
                        <label>添加新词汇</label>
                        <div class="vocab-form">
                            <input type="text" id="vocab-chinese" placeholder="中文词汇（例如：绩优股）">
                            <input type="text" id="vocab-german" placeholder="德语表达（例如：Top Aktien）">
                            <div class="vocab-form-actions">
                                <button class="btn btn-primary btn-small" id="save-vocab-btn">保存</button>
                                <button class="btn btn-secondary btn-small" id="cancel-vocab-btn">取消</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-group">
                        <label>当前词汇表</label>
                        <div class="vocab-list" id="vocab-list">
                            <div class="vocab-empty">请选择用户查看词汇表</div>
                        </div>
                    </div>
                    
                    <div class="config-group">
                        <label>使用说明</label>
                        <div class="vocab-help">
                            <p>• 添加专业术语的固定翻译对照</p>
                            <p>• 翻译时会自动使用您的词汇表</p>
                            <p>• 每个用户可以维护独立的词汇表</p>
                            <p>• 支持导入/导出功能便于备份</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="close-vocabulary">关闭</button>
                </div>
            </div>
        </div>

        <!-- 教程模态框 -->
        <div id="tutorial-modal" class="modal hidden">
            <div class="modal-content tutorial-modal-content">
                <div class="modal-header">
                    <h3>📚 中译德功能使用教程</h3>
                    <button class="close-btn" id="close-tutorial-modal">&times;</button>
                </div>
                <div class="modal-body tutorial-modal-body">
                    <div class="tutorial-section">
                        <h4>🎯 功能概述</h4>
                        <p>中译德模块支持最多3个并行任务，每个任务可以独立进行翻译操作，非常适合处理多个不同的文本内容。每个任务标题可以自定义编辑，方便您管理不同类型的翻译工作。</p>
                    </div>

                    <div class="tutorial-section">
                        <h4>👥 选择翻译角色</h4>
                        <div class="tutorial-roles">
                            <div class="role-item">
                                <span class="role-icon">👨‍🎓</span>
                                <div class="role-desc">
                                    <strong>男教授</strong>: 权威但友善的群聊风格，适合男性教授在投资群中分享见解
                                </div>
                            </div>
                            <div class="role-item">
                                <span class="role-icon">👩‍🎓</span>
                                <div class="role-desc">
                                    <strong>女教授</strong>: 权威但温和的群聊风格，适合女性教授在投资群中提供指导
                                </div>
                            </div>
                            <div class="role-item">
                                <span class="role-icon">👨‍💼</span>
                                <div class="role-desc">
                                    <strong>男助理</strong>: 热情主动的群聊风格，适合男性助理为群友提供帮助
                                </div>
                            </div>
                            <div class="role-item">
                                <span class="role-icon">👩‍💼</span>
                                <div class="role-desc">
                                    <strong>女助理</strong>: 贴心细致的群聊风格，适合女性助理温馨提醒和帮助
                                </div>
                            </div>
                            <div class="role-item">
                                <span class="role-icon">🙋‍♂️</span>
                                <div class="role-desc">
                                    <strong>男水军</strong>: 活跃幽默的群聊风格，能带动气氛引发互动
                                </div>
                            </div>
                            <div class="role-item">
                                <span class="role-icon">🙋‍♀️</span>
                                <div class="role-desc">
                                    <strong>女水军</strong>: 活跃生动的群聊风格，善于活跃氛围制造话题
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h4>🔧 功能按钮说明</h4>
                        <div class="tutorial-buttons">
                            <div class="button-item">
                                <span class="button-demo btn-demo primary">🔄 翻译</span>
                                <p>执行翻译，会自动进行回译验证并显示人称形式（Du/Sie）</p>
                            </div>
                            <div class="button-item">
                                <span class="button-demo btn-demo secondary">🧹 去除备注</span>
                                <p>清理中文原文中的称呼、备注、编号等无关内容，可撤销</p>
                            </div>
                            <div class="button-item">
                                <span class="button-demo btn-demo secondary">🔄 你您切换</span>
                                <p>智能转换德语译文的人称形式（Du ↔ Sie）</p>
                            </div>
                            <div class="button-item">
                                <span class="button-demo btn-demo secondary">✂️ 去短横线</span>
                                <p>将德语译文中的短横线替换为逗号</p>
                            </div>
                            <div class="button-item">
                                <span class="button-demo btn-demo secondary">😶 去除表情</span>
                                <p>移除德语译文中的表情符号</p>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h4>📋 复制功能</h4>
                        <div class="tutorial-copy">
                            <div class="copy-item">
                                <span class="button-demo btn-demo outline">原文</span>
                                <span class="button-demo btn-demo outline">译文</span>
                                <span class="button-demo btn-demo outline">原文+译文</span>
                            </div>
                            <p>支持一键复制不同内容组合到剪贴板</p>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h4>⌨️ 快捷键设置</h4>
                        <div class="tutorial-shortcuts">
                            <div class="shortcut-demo">
                                <span class="button-demo btn-demo accent">⌨️ 快捷键设置</span>
                                <p>点击左上角快捷键设置按钮，为常用功能自定义快捷键</p>
                            </div>
                            <div class="shortcut-features">
                                <ul>
                                    <li><strong>智能录制</strong>：点击输入框后按下组合键即可设置</li>
                                    <li><strong>冲突检测</strong>：系统会自动检测并提示快捷键冲突</li>
                                    <li><strong>持久保存</strong>：设置自动保存，页面刷新后保持</li>
                                    <li><strong>多任务支持</strong>：快捷键自动作用于当前活跃任务</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="tutorial-section">
                        <h4>⚡ 使用技巧</h4>
                        <ul class="tutorial-tips">
                            <li><strong>多任务并行</strong>：点击"添加任务"可同时处理多个文本</li>
                            <li><strong>自定义标题</strong>：点击任务标题（如"任务1"）可编辑为自定义名称，自动保存</li>
                            <li><strong>实时编辑</strong>：德语译文可直接编辑，会自动重新回译</li>
                            <li><strong>词汇表</strong>：点击右下角📚按钮管理专业术语</li>
                            <li><strong>人称检测</strong>：翻译后会在德语译文标签右侧显示使用的人称形式</li>
                            <li><strong>结果计时</strong>：翻译完成后会在中文文本标签右侧显示结果获得时间，最长计时20分钟</li>
                            <li><strong>快捷键</strong>：Ctrl+Enter 快速执行翻译，点击"⌨️ 快捷键设置"自定义更多快捷键</li>
                        </ul>
                    </div>

                    <div class="tutorial-section">
                        <h4>🔑 开始使用</h4>
                        <ol class="tutorial-steps">
                            <li>确保已在右下角⚙️设置中配置API密钥</li>
                            <li>在"中文文本"框输入要翻译的内容</li>
                            <li>选择合适的翻译角色</li>
                            <li>点击"翻译"按钮开始翻译</li>
                            <li>查看德语译文和回译结果，翻译完成后会自动开始计时</li>
                            <li>根据需要使用其他功能按钮优化译文</li>
                        </ol>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" id="close-tutorial">开始使用</button>
                </div>
            </div>
        </div>

        <!-- 快捷键设置模态框 -->
        <div id="shortcut-modal" class="modal hidden">
            <div class="modal-content shortcut-modal-content">
                <div class="modal-header">
                    <h3>⌨️ 快捷键设置</h3>
                    <button class="close-btn" id="close-shortcut-modal">&times;</button>
                </div>
                <div class="modal-body shortcut-modal-body">
                    <div class="shortcut-section">
                        <h4>🎯 功能说明</h4>
                        <p>为常用功能设置快捷键，提高翻译效率。点击输入框后按下组合键即可设置（支持 Ctrl/Alt/Shift + 字母/数字）。</p>
                    </div>

                    <div class="shortcut-section">
                        <h4>🔄 翻译功能</h4>
                        <div class="shortcut-items">
                            <div class="shortcut-item">
                                <label>翻译</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-translate" data-action="translate" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-translate">×</button>
                                </div>
                                <small>执行中译德翻译</small>
                            </div>
                            <div class="shortcut-item">
                                <label>重新翻译</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-retranslate" data-action="retranslate" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-retranslate">×</button>
                                </div>
                                <small>重新执行翻译</small>
                            </div>
                            <div class="shortcut-item">
                                <label>去除备注</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-remove-comments" data-action="remove-comments" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-remove-comments">×</button>
                                </div>
                                <small>清洗中文原文备注</small>
                            </div>
                            <div class="shortcut-item">
                                <label>清空</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-clear" data-action="clear" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-clear">×</button>
                                </div>
                                <small>清空所有内容</small>
                            </div>
                        </div>
                    </div>

                    <div class="shortcut-section">
                        <h4>🔧 文本处理</h4>
                        <div class="shortcut-items">
                            <div class="shortcut-item">
                                <label>你您切换</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-du-sie" data-action="du-sie" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-du-sie">×</button>
                                </div>
                                <small>Du/Sie 人称转换</small>
                            </div>
                            <div class="shortcut-item">
                                <label>去短横线</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-remove-dash" data-action="remove-dash" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-remove-dash">×</button>
                                </div>
                                <small>移除德语中的短横线</small>
                            </div>
                            <div class="shortcut-item">
                                <label>去除表情</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-remove-emoji" data-action="remove-emoji" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-remove-emoji">×</button>
                                </div>
                                <small>移除表情符号</small>
                            </div>
                        </div>
                    </div>

                    <div class="shortcut-section">
                        <h4>📋 复制功能</h4>
                        <div class="shortcut-items">
                            <div class="shortcut-item">
                                <label>复制原文</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-copy-original" data-action="copy-original" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-copy-original">×</button>
                                </div>
                                <small>复制中文原文</small>
                            </div>
                            <div class="shortcut-item">
                                <label>复制译文</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-copy-translation" data-action="copy-translation" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-copy-translation">×</button>
                                </div>
                                <small>复制德语译文</small>
                            </div>
                            <div class="shortcut-item">
                                <label>复制原文+译文</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-copy-both" data-action="copy-both" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-copy-both">×</button>
                                </div>
                                <small>复制中德文对照</small>
                            </div>
                        </div>
                    </div>

                    <div class="shortcut-section">
                        <h4>📝 任务管理</h4>
                        <div class="shortcut-items">
                            <div class="shortcut-item">
                                <label>添加任务</label>
                                <div class="shortcut-input-group">
                                    <input type="text" class="shortcut-input" id="shortcut-add-task" data-action="add-task" placeholder="点击后按快捷键" readonly>
                                    <button class="clear-shortcut" data-target="shortcut-add-task">×</button>
                                </div>
                                <small>添加新的翻译任务</small>
                            </div>
                        </div>
                    </div>

                    <div class="shortcut-section">
                        <h4>💡 使用说明</h4>
                        <div class="shortcut-help">
                            <ul>
                                <li><strong>设置方法</strong>：点击输入框，然后按下组合键（如 Ctrl+T、Alt+C 等）</li>
                                <li><strong>支持组合</strong>：Ctrl、Alt、Shift + 字母/数字/功能键</li>
                                <li><strong>冲突检测</strong>：系统会自动检测并提示快捷键冲突</li>
                                <li><strong>多任务</strong>：快捷键会作用于当前激活的任务</li>
                                <li><strong>清除设置</strong>：点击输入框右侧的 × 清除快捷键</li>
                            </ul>
                        </div>
                    </div>

                    <div class="shortcut-section">
                        <h4>⚠️ 当前快捷键冲突</h4>
                        <div id="shortcut-conflicts" class="shortcut-conflicts" style="display: none;">
                            <!-- 冲突信息将在这里显示 -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="reset-shortcuts">重置所有</button>
                    <button class="btn btn-primary" id="save-shortcuts">保存设置</button>
                </div>
            </div>
        </div>

        <!-- 浮动按钮组 -->
        <div class="floating-buttons">
            <!-- 词汇表按钮 -->
            <button id="vocabulary-btn" class="floating-config-btn" title="词汇表管理">
                <span class="config-icon">📚</span>
            </button>
            
            <!-- API配置按钮 -->
            <button id="api-config-btn" class="floating-config-btn" title="API配置">
                <span class="config-icon">⚙️</span>
            </button>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="prompts-config.js"></script>
    <script src="script.js"></script>
    <script src="api-integration.js"></script>
</body>
</html> 